#!/bin/bash
# ðŸŽ¸ INDUSTRIAL MIDI CREATOR - CLASSIC MONOLITH ðŸŽ¸

PORT=8083

echo "âš¡ INDUSTRIAL MIDI CREATOR [ORIGINAL] âš¡"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "         THE MONOLITH AWAKENS"

# Kill any weaklings on our port
EXISTING_PID=$(lsof -ti :$PORT 2>/dev/null)
if [ ! -z "$EXISTING_PID" ]; then
    echo "ðŸ’€ CRUSHING process $EXISTING_PID..."
    kill -9 $EXISTING_PID
    sleep 0.5
    echo "âœ“ ANNIHILATED!"
fi

# RESURRECT THE ANCIENT ONE
echo "ðŸ—¿ SUMMONING THE MONOLITHIC SERVER..."
python3 -m http.server $PORT > /dev/null 2>&1 &
SERVER_PID=$!

# Let the ancient powers gather
sleep 0.5

# Verify our dominion
if ! lsof -ti :$PORT > /dev/null 2>&1; then
    echo "âŒ THE MONOLITH REJECTS US!"
    echo "Perhaps it requires more power..."
    exit 1
fi

echo "âš¡ MONOLITH ONLINE [PID: $SERVER_PID]"

# OPEN THE PORTAL
URL="http://localhost:$PORT/index.html"
echo "ðŸŒ€ OPENING PORTAL TO THE VOID..."

if [[ "$OSTYPE" == "linux-gnu"* ]]; then
    xdg-open "$URL" 2>/dev/null
elif [[ "$OSTYPE" == "darwin"* ]]; then
    open "$URL"
elif [[ "$OSTYPE" == "cygwin" ]] || [[ "$OSTYPE" == "msys" ]] || [[ "$OSTYPE" == "win32" ]]; then
    start "$URL"
else
    echo "âš ï¸  MANUAL SUMMONING REQUIRED: $URL"
fi

echo ""
echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘   ðŸ›ï¸  THE MONOLITH STANDS  ðŸ›ï¸         â•‘"
echo "â•‘   2600+ lines of raw power!           â•‘"
echo "â•‘   Port: $PORT | PID: $SERVER_PID              â•‘"
echo "â•‘   [Ctrl+C] to BANISH                  â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

# Eternal vigil
trap ctrl_c INT

function ctrl_c() {
    echo ""
    echo "ðŸŒ‘ THE MONOLITH RETURNS TO SLUMBER..."
    kill $SERVER_PID 2>/dev/null
    echo "ðŸ—¿ Until next time, mortals."
    exit 0
}

# The monolith endures
while true; do
    sleep 1
done